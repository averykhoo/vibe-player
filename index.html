<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Audio Player - Auto HQ</title>
    <!-- Link to the CSS file for styling -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Main title of the application -->
    <h1>Web Audio Player - Auto HQ</h1>

    <!-- Section for loading the audio file -->
    <section id="file-loader">
        <h2>Load Audio File</h2>
        <!-- Standard file input, accepting any audio format the browser understands -->
        <input type="file" id="audioFile" accept="audio/*">
        <!-- Paragraph to display the loaded file name or status messages -->
        <p id="fileInfo">No file selected.</p>
        <!-- Span to show background processing status (initially hidden) -->
        <span id="processingStatus" class="spinner" style="margin-left: 10px; display: none;"></span>
    </section>

    <!-- Section containing all playback controls -->
    <section id="controls">
        <h2>Controls</h2>
        <!-- Group for primary playback actions -->
        <div id="playbackButtons">
            <!-- Play/Pause button, disabled initially -->
            <button id="playPause" disabled>Play</button>
            <!-- Button to switch between Normal and HQ 0.5x speed playback -->
            <!-- Starts disabled, enabled when HQ processing finishes -->
            <button id="switchHQ" disabled>HQ 0.5x Processing...</button>
            <!-- Jump Back button, disabled initially -->
            <button id="jumpBack" disabled>&#9664;&#9664; Back</button>
            <!-- Input field to set the jump time in seconds -->
            <input type="number" id="jumpTime" value="5" min="1" step="1" style="width: 40px;">s
            <!-- Jump Forward button, disabled initially -->
            <button id="jumpForward" disabled>Forward &#9654;&#9654;</button>
        </div>

        <!-- Group for speed control -->
        <div class="control-group">
            <label for="playbackSpeed">Speed:</label>
            <!-- Range slider for playback speed (0.25x to 4.0x for normal mode) -->
            <input type="range" id="playbackSpeed" min="0.25" max="4.0" value="1.0" step="0.01" disabled>
            <!-- Displays the current speed value -->
            <span id="speedValue">1.00x</span>
        </div>

        <!-- Group for volume control -->
        <div class="control-group">
            <label for="gainControl">Volume:</label>
            <!-- Range slider for volume (0 to 2x gain) -->
            <input type="range" id="gainControl" min="0" max="2" value="1.0" step="0.01">
            <!-- Displays the current volume value -->
            <span id="gainValue">1.00x</span>
        </div>

        <!-- Displays current playback time and total duration -->
        <div id="timeDisplay">0:00 / 0:00</div>
    </section>

    <!-- Section for the waveform visualization -->
    <section class="visualization">
        <h3>Waveform</h3>
        <!-- Canvas element where the waveform will be drawn -->
        <canvas id="waveformCanvas"></canvas>
        <!-- Container for the progress indicator overlay -->
        <!-- Positioned absolutely over the canvases -->
        <div id="progressBar">
             <!-- The actual moving red line indicating progress -->
             <div id="progressIndicator"></div>
        </div>
    </section>

    <!-- Section for the spectrogram visualization -->
    <section class="visualization">
        <!-- Title with a spinner shown during spectrogram computation -->
        <h3>Spectrogram <span id="spectrogramSpinner" class="spinner">(Computing...)</span></h3>
        <!-- Canvas element where the spectrogram will be drawn -->
        <canvas id="spectrogramCanvas"></canvas>
    </section>

    <!-- Section listing keyboard shortcuts -->
    <section id="keybinds">
      <h2>Keyboard Shortcuts</h2>
      <table>
        <thead>
          <tr><th>Key</th><th>Action</th></tr>
        </thead>
        <tbody>
          <tr><td>Space</td><td>Play / Pause</td></tr>
          <tr><td>Left Arrow</td><td>Jump Back (Normal Mode Only)</td></tr>
          <tr><td>Right Arrow</td><td>Jump Forward (Normal Mode Only)</td></tr>
        </tbody>
      </table>
    </section>

    <!-- The hidden HTML <audio> element -->
    <!-- This element is used for STANDARD playback (Source A). -->
    <!-- It leverages the browser's built-in decoding and playback for efficiency. -->
    <!-- 'preload="auto"' hints the browser it can start loading metadata/data. -->
    <audio id="player" style="display: none;" preload="auto"></audio>

    <!-- Link to the main JavaScript file -->
    <!-- 'defer' ensures the script runs only after the HTML is fully parsed -->
    <script src="player.js" defer></script>

</body>
</html>